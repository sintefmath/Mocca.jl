<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Simulate cyclic · Mocca.jl</title><meta name="title" content="Simulate cyclic · Mocca.jl"/><meta property="og:title" content="Simulate cyclic · Mocca.jl"/><meta property="twitter:title" content="Simulate cyclic · Mocca.jl"/><meta name="description" content="Documentation for Mocca.jl."/><meta property="og:description" content="Documentation for Mocca.jl."/><meta property="twitter:description" content="Documentation for Mocca.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Mocca.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../installation/">Installation</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../simulate_DCB/">Simulate DCB</a></li><li class="is-active"><a class="tocitem" href>Simulate cyclic</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#Create-the-model"><span>Create the model</span></a></li><li class="toplevel"><a class="tocitem" href="#Setup-the-initial-state"><span>Setup the initial state</span></a></li><li class="toplevel"><a class="tocitem" href="#Setup-the-timestepping-and-boundary-conditions"><span>Setup the timestepping and boundary conditions</span></a></li><li class="toplevel"><a class="tocitem" href="#Simulate"><span>Simulate</span></a></li><li class="toplevel"><a class="tocitem" href="#Plot"><span>Plot</span></a></li><li><a class="tocitem" href="#Example-on-GitHub"><span>Example on GitHub</span></a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Simulate cyclic</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Simulate cyclic</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/sintefmath/Mocca.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/sintefmath/Mocca.jl/blob/master/examples/simulate_cyclic.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Cyclic-Vacuum-Swing-Adsorption-simulation"><a class="docs-heading-anchor" href="#Cyclic-Vacuum-Swing-Adsorption-simulation">Cyclic Vacuum Swing Adsorption simulation</a><a id="Cyclic-Vacuum-Swing-Adsorption-simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Cyclic-Vacuum-Swing-Adsorption-simulation" title="Permalink"></a></h1><p>This example shows how to setup and run a cyclic vacuum swing adsorption simulation as described in <a href="http://dx.doi.org/10.1021/ie302658y">Haghpanah et al. 2013</a></p><ul><li></li></ul><p>This simulation inolves injection of a two component flue gas (CO2 and N2) into a column of Zeolite 13X. The CO2 is preferentially adsorbed onto the zeolite. Pressure in the column is then reduced to enable desorption of CO2 for collection.</p><ul><li></li></ul><p>This is a four stage process comprising:</p><ul><li>Pressurisation: where the rhs of the column is closed and flue gas is injected from</li></ul><p>the lhs, at velocity <code>v_feed</code>, to bring the column pressure up to <code>PH</code> (Pressure High)</p><ul><li>Adsorption: Where both ends of the column are open and flue gas is injected from the</li></ul><p>rhs at velocity <code>v_feed</code>. Pressure at the lhs is <code>PH</code></p><ul><li>Blowdown: where the lhs of the column is closed and the column is evacuated at</li></ul><p><code>PI</code> (Pressure Intermediate)</p><ul><li>Evacuation: where the rhs of the column is closed and the column is evacuated from the</li></ul><p>lhs at <code>PL</code> (Pressure Low).</p><p>Each stage is modelled using the same governing equations but with different boundary conditions.</p><p>Adsorption onto Zeolite 13X is modelled with a dual-site Langumuir adsorption isotherm.</p><p>First we load the necessary modules</p><pre><code class="language-julia hljs">import Jutul
import JutulDarcy

import Mocca</code></pre><p>Then we define parameters which we want. We have defined a structure containing parameters from Haghpanah et al. 2013 which we load now.</p><pre><code class="language-julia hljs">constants = Mocca.HaghpanahConstants()</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">HaghpanahConstants{Float64}
  molecularMassOfCO2: Float64 0.04401
  molecularMassOfN2: Float64 0.028
  R: Float64 8.3144598
  Φ: Float64 0.37
  b0: StaticArraysCore.SVector{2, Float64}
  d0: StaticArraysCore.SVector{2, Float64}
  ΔUbi: StaticArraysCore.SVector{2, Float64}
  ΔUdi: StaticArraysCore.SVector{2, Float64}
  qsbi: StaticArraysCore.SVector{2, Float64}
  qsdi: StaticArraysCore.SVector{2, Float64}
  ϵ_p: Float64 0.35
  D_m: Float64 1.6e-5
  τ: Float64 3.0
  d_p: Float64 0.002
  V0_inter: Float64 1.0
  fluid_viscosity: Float64 1.72e-5
  K_z: Float64 0.0903
  K_w: Float64 16.0
  ρ_s: Float64 1130.0
  ρ_g: Float64 1.22638310956
  C_pg: StaticArraysCore.SVector{2, Float64}
  C_pa: StaticArraysCore.SVector{2, Float64}
  C_ps: Float64 1070.0
  r_in: Float64 0.1445
  r_out: Float64 0.162
  h_in: Float64 8.6
  h_out: Float64 2.5
  ρ_w: Float64 7800.0
  C_pw: Float64 502.0
  T0: Float64 298.15
  T_a: Float64 298.15
  v_feed: Float64 0.37
  y_feed: StaticArraysCore.SVector{2, Float64}
  p_high: Float64 100000.0
  p_intermediate: Float64 20000.0
  p_low: Float64 10000.0
  λ: Float64 0.5
  T_feed: Float64 298.15
  L: Float64 1.0
</code></pre><p>Then we need to make the model. This model contains information about the domain (mesh)) which we will solve the equations over and a information about the system of equations which we are solving.</p><p>In this instance we will use the same system as in Haghpanah, which is a two component adsorption system. This system type is associated with the appropriate equations and primary and secondary variables. We also add the parameters and the desired velocity model as an input.</p><pre><code class="language-julia hljs">permeability = Mocca.compute_permeability(constants)
axial_dispersion = Mocca.calc_dispersion(constants)

system = Mocca.TwoComponentAdsorptionSystem(; permeability = permeability, dispersion = axial_dispersion, p = constants)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">TwoComponentAdsorptionSystem{HaghpanahConstants{Float64}}
  component_names: Array{String}((2,))
  permeability: Float64 3.403241790543378e-9
  dispersion: Float64 0.0010112
  p: HaghpanahConstants{Float64}
</code></pre><p>Jutul uses finite volume discretisation in space. To model a 1D cylindrical column we setup a cartesian grid with ncells x 1 x 1 dimensions. To ensure we have the correct interface area between cells we set <span>$dx = \sqrt(\pi*r_{in})$</span> where <code>r_{in}</code> is the inner radius of the column.</p><pre><code class="language-julia hljs">ncells = 200

dx = sqrt(pi*constants.r_in^2)
mesh = Jutul.CartesianMesh((ncells, 1, 1), (constants.L, dx, dx))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">CartesianMesh (3D) with 200x1x1=200 cells</code></pre><p>Because JutulDarcy has its roots in reservoir simulation we need to formulate our velocity equation in the following form: <span>$q = -\frac{k}{\mu}\frac{\partial{P}\partial{x}}$</span> where <code>k</code> is known as the permeability. In this instance we use the pressure drop equation for plug flow in a packed bed. The velocity model specified when instantiating the system automatically calculates the permeability required for input to the domain.</p><p>The domain also contains the mass diffusion coefficient to calculate mass transport between cells and the thermal conductivity to calculate heat transfer</p><pre><code class="language-julia hljs">domain = Mocca.mocca_domain(mesh, system)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">DataDomain wrapping CartesianMesh (3D) with 200x1x1=200 cells with 17 data fields added:
  200 Jutul.Cells
    :permeability =&gt; 200 Vector{Float64}
    :porosity =&gt; 200 Vector{Float64}
    :cell_centroids =&gt; 3×200 Matrix{Float64}
    :volumes =&gt; 200 Vector{Float64}
    :diffusion_coefficient =&gt; 200 Vector{Float64}
    :thermal_conductivity =&gt; 200 Vector{Float64}
    :dx =&gt; 200 Vector{Float64}
  199 Jutul.Faces
    :neighbors =&gt; 2×199 Matrix{Int64}
    :areas =&gt; 199 Vector{Float64}
    :normals =&gt; 3×199 Matrix{Float64}
    :face_centroids =&gt; 3×199 Matrix{Float64}
  398 Jutul.HalfFaces
    :half_face_cells =&gt; 398 Vector{Int64}
    :half_face_faces =&gt; 398 Vector{Int64}
  802 Jutul.BoundaryFaces
    :boundary_areas =&gt; 802 Vector{Float64}
    :boundary_centroids =&gt; 3×802 Matrix{Float64}
    :boundary_normals =&gt; 3×802 Matrix{Float64}
    :boundary_neighbors =&gt; 802 Vector{Int64}
</code></pre><h1 id="Create-the-model"><a class="docs-heading-anchor" href="#Create-the-model">Create the model</a><a id="Create-the-model-1"></a><a class="docs-heading-anchor-permalink" href="#Create-the-model" title="Permalink"></a></h1><p>Now we can assemble the model which contains the domain and the system of equations.</p><pre><code class="language-julia hljs">model = Jutul.SimulationModel(domain, system, general_ad = true)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">SimulationModel:
  domain:
    DiscretizedDomain with MinimalTPFATopology (200 cells, 199 faces) and discretizations for mass_flow, heat_flow

  system:
    TwoComponentAdsorptionSystem{HaghpanahConstants{Float64}}
  component_names: Array{String}((2,))
  permeability: Float64 3.403241790543378e-9
  dispersion: Float64 0.0010112
  p: HaghpanahConstants{Float64}


  context:
    Jutul.DefaultContext(Jutul.EquationMajorLayout(false), 1000, 1)

  formulation:
    Jutul.FullyImplicitFormulation()

  data_domain:
    DataDomain wrapping CartesianMesh (3D) with 200x1x1=200 cells with 17 data fields added:
  200 Jutul.Cells
    :permeability =&gt; 200 Vector{Float64}
    :porosity =&gt; 200 Vector{Float64}
    :cell_centroids =&gt; 3×200 Matrix{Float64}
    :volumes =&gt; 200 Vector{Float64}
    :diffusion_coefficient =&gt; 200 Vector{Float64}
    :thermal_conductivity =&gt; 200 Vector{Float64}
    :dx =&gt; 200 Vector{Float64}
  199 Jutul.Faces
    :neighbors =&gt; 2×199 Matrix{Int64}
    :areas =&gt; 199 Vector{Float64}
    :normals =&gt; 3×199 Matrix{Float64}
    :face_centroids =&gt; 3×199 Matrix{Float64}
  398 Jutul.HalfFaces
    :half_face_cells =&gt; 398 Vector{Int64}
    :half_face_faces =&gt; 398 Vector{Int64}
  802 Jutul.BoundaryFaces
    :boundary_areas =&gt; 802 Vector{Float64}
    :boundary_centroids =&gt; 3×802 Matrix{Float64}
    :boundary_normals =&gt; 3×802 Matrix{Float64}
    :boundary_neighbors =&gt; 802 Vector{Int64}

  primary_variables:
   1) Pressure              ∈ 200 Jutul.Cells: 1 dof each
   2) y                     ∈ 200 Jutul.Cells: 1 dof, 2 values each
   3) AdsorbedConcentration ∈ 200 Jutul.Cells: 2 dof each
   4) Temperature           ∈ 200 Jutul.Cells: 1 dof each
   5) WallTemperature       ∈ 200 Jutul.Cells: 1 dof each

  secondary_variables:
   1) cTot                   ∈ 200 Jutul.Cells: Scalar
      -&gt; JutulDarcy.TotalMass as evaluator
   2) concentrations         ∈ 200 Jutul.Cells: 2 values each
      -&gt; Mocca.Concentrations as evaluator
   3) avm                    ∈ 200 Jutul.Cells: Scalar
      -&gt; Mocca.AverageMolecularMass as evaluator
   4) TotalMasses            ∈ 200 Jutul.Cells: 2 values each
      -&gt; JutulDarcy.TotalMasses as evaluator
   5) AdsorptionMassTransfer ∈ 200 Jutul.Cells: 2 values each
      -&gt; Mocca.AdsorptionMassTransfer as evaluator
   6) ColumnConservedEnergy  ∈ 200 Jutul.Cells: Scalar
      -&gt; Mocca.ColumnEnergy as evaluator
   7) WallConservedEnergy    ∈ 200 Jutul.Cells: Scalar
      -&gt; Mocca.WallEnergy as evaluator
   8) ΔH                     ∈ 200 Jutul.Cells: 2 values each
      -&gt; Mocca.EnthalpyChange as evaluator
   9) C_pa                   ∈ 200 Jutul.Cells: Scalar
      -&gt; Mocca.SpecificHeatCapacityAdsorbent as evaluator
   10) C_pg                   ∈ 200 Jutul.Cells: Scalar
      -&gt; Mocca.SpecificHeatCapacityFluid as evaluator

  parameters:
   1) Transmissibilities          ∈ 199 Jutul.Faces: Scalar
   2) TwoPointGravityDifference   ∈ 199 Jutul.Faces: Scalar
   3) SolidVolume                 ∈ 200 Jutul.Cells: Scalar
   4) FluidVolume                 ∈ 200 Jutul.Cells: Scalar
   5) WallAreaOut                 ∈ 200 Jutul.Cells: Scalar
   6) WallAreaIn                  ∈ 200 Jutul.Cells: Scalar
   7) CellDx                      ∈ 200 Jutul.Cells: Scalar
   8) ThermalConductivities       ∈ 199 Jutul.Faces: Scalar
   9) DiffusionTransmissibilities ∈ 199 Jutul.Faces: Scalar

  equations:
   1) mass_conservation ∈ 200 Jutul.Cells: 2 values each
      -&gt; Jutul.ConservationLaw{:TotalMasses, Jutul.PotentialFlow{Vector{Jutul.TPFA{Int64}}, Vector{Jutul.SPU{Int64}}, NamedTuple{(:cells, :faces, :face_pos, :face_sign), NTuple{4, Vector{Int64}}}}, Jutul.DefaultFlux, 2}
   2) mass_transfer ∈ 200 Jutul.Cells: 2 values each
      -&gt; Jutul.ConservationLaw{:AdsorbedConcentration, Jutul.PotentialFlow{Vector{Jutul.TPFA{Int64}}, Vector{Jutul.SPU{Int64}}, NamedTuple{(:cells, :faces, :face_pos, :face_sign), NTuple{4, Vector{Int64}}}}, Jutul.DefaultFlux, 2}
   3) energy_column ∈ 200 Jutul.Cells: 1 values each
      -&gt; Jutul.ConservationLaw{:ColumnConservedEnergy, Jutul.PotentialFlow{Vector{Jutul.TPFA{Int64}}, Vector{Jutul.SPU{Int64}}, NamedTuple{(:cells, :faces, :face_pos, :face_sign), NTuple{4, Vector{Int64}}}}, Jutul.DefaultFlux, 1}
   4) energy_wall ∈ 200 Jutul.Cells: 1 values each
      -&gt; Jutul.ConservationLaw{:WallConservedEnergy, Jutul.PotentialFlow{Vector{Jutul.TPFA{Int64}}, Vector{Jutul.SPU{Int64}}, NamedTuple{(:cells, :faces, :face_pos, :face_sign), NTuple{4, Vector{Int64}}}}, Jutul.DefaultFlux, 1}

  output_variables:
    Pressure, y, AdsorbedConcentration, Temperature, WallTemperature, TotalMasses

  extra:
    OrderedCollections.OrderedDict{Symbol, Any}()

</code></pre><h1 id="Setup-the-initial-state"><a class="docs-heading-anchor" href="#Setup-the-initial-state">Setup the initial state</a><a id="Setup-the-initial-state-1"></a><a class="docs-heading-anchor-permalink" href="#Setup-the-initial-state" title="Permalink"></a></h1><p>The final thing required to create the simulator is the intial state of the system #WRITE #TODO: can this be put in functions</p><pre><code class="language-julia hljs">barsa = 1e5 #TODO: see if this exists
P_init = 1.0*barsa
T_init = 298.15
Tw_init = constants.T_a

yCO2 = ones(ncells)*1e-10
y_init = hcat(yCO2, 1 .- yCO2)

state0, prm = Mocca.initialise_state_AdsorptionColumn(P_init, T_init, Tw_init, y_init, model)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(Dict{Symbol, Any}(:AdsorbedConcentration =&gt; [1.0e-10 1.0e-10 … 1.0e-10 1.0e-10; 369.15019609545607 369.15019609545607 … 369.15019609545607 369.15019609545607], :WallConservedEnergy =&gt; [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], :Temperature =&gt; [298.15, 298.15, 298.15, 298.15, 298.15, 298.15, 298.15, 298.15, 298.15, 298.15  …  298.15, 298.15, 298.15, 298.15, 298.15, 298.15, 298.15, 298.15, 298.15, 298.15], :avm =&gt; [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], :C_pg =&gt; [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], :ΔH =&gt; [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], :ColumnConservedEnergy =&gt; [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], :concentrations =&gt; [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0], :y =&gt; [1.0e-10 1.0e-10 … 1.0e-10 1.0e-10; 0.9999999999 0.9999999999 … 0.9999999999 0.9999999999], :AdsorptionMassTransfer =&gt; [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0]…), Dict{Symbol, Any}(:ThermalConductivities =&gt; [1.1846861544924363, 1.184686154492436, 1.1846861544924367, 1.1846861544924359, 1.1846861544924359, 1.1846861544924359, 1.1846861544924352, 1.1846861544924367, 1.1846861544924367, 1.1846861544924352  …  1.1846861544924352, 1.1846861544924352, 1.1846861544924616, 1.1846861544924352, 1.1846861544924352, 1.1846861544924352, 1.1846861544924352, 1.1846861544924352, 1.1846861544924352, 1.1846861544924352], :Transmissibilities =&gt; [4.46486537059445e-8, 4.4648653705944486e-8, 4.464865370594451e-8, 4.4648653705944486e-8, 4.4648653705944486e-8, 4.4648653705944486e-8, 4.4648653705944446e-8, 4.464865370594451e-8, 4.464865370594451e-8, 4.4648653705944446e-8  …  4.464865370594445e-8, 4.464865370594445e-8, 4.464865370594544e-8, 4.464865370594445e-8, 4.464865370594445e-8, 4.464865370594445e-8, 4.464865370594445e-8, 4.464865370594445e-8, 4.464865370594445e-8, 4.464865370594445e-8], :FluidVolume =&gt; [0.00012135489400946882, 0.00012135489400946882, 0.00012135489400946882, 0.00012135489400946882, 0.00012135489400946882, 0.00012135489400946882, 0.00012135489400946882, 0.00012135489400946882, 0.00012135489400946882, 0.00012135489400946882  …  0.00012135489400946882, 0.00012135489400946882, 0.00012135489400946882, 0.00012135489400946882, 0.00012135489400946882, 0.00012135489400946882, 0.00012135489400946882, 0.00012135489400946882, 0.00012135489400946882, 0.00012135489400946882], :TwoPointGravityDifference =&gt; [-0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0  …  -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0, -0.0], :SolidVolume =&gt; [0.00020663130601612258, 0.00020663130601612258, 0.00020663130601612258, 0.00020663130601612258, 0.00020663130601612258, 0.00020663130601612258, 0.00020663130601612258, 0.00020663130601612258, 0.00020663130601612258, 0.00020663130601612258  …  0.00020663130601612258, 0.00020663130601612258, 0.00020663130601612258, 0.00020663130601612258, 0.00020663130601612258, 0.00020663130601612258, 0.00020663130601612258, 0.00020663130601612258, 0.00020663130601612258, 0.00020663130601612258], :WallAreaIn =&gt; [0.004539601384437251, 0.004539601384437251, 0.004539601384437251, 0.004539601384437251, 0.004539601384437251, 0.004539601384437251, 0.004539601384437251, 0.004539601384437251, 0.004539601384437251, 0.004539601384437251  …  0.004539601384437251, 0.004539601384437251, 0.004539601384437251, 0.004539601384437251, 0.004539601384437251, 0.004539601384437251, 0.004539601384437251, 0.004539601384437251, 0.004539601384437251, 0.004539601384437251], :DiffusionTransmissibilities =&gt; [0.013266385818635124, 0.013266385818635118, 0.013266385818635129, 0.013266385818635118, 0.013266385818635118, 0.013266385818635118, 0.013266385818635108, 0.013266385818635129, 0.013266385818635129, 0.013266385818635108  …  0.01326638581863511, 0.01326638581863511, 0.013266385818635406, 0.01326638581863511, 0.01326638581863511, 0.01326638581863511, 0.01326638581863511, 0.01326638581863511, 0.01326638581863511, 0.01326638581863511], :WallAreaOut =&gt; [0.005089380098815465, 0.005089380098815465, 0.005089380098815465, 0.005089380098815465, 0.005089380098815465, 0.005089380098815465, 0.005089380098815465, 0.005089380098815465, 0.005089380098815465, 0.005089380098815465  …  0.005089380098815465, 0.005089380098815465, 0.005089380098815465, 0.005089380098815465, 0.005089380098815465, 0.005089380098815465, 0.005089380098815465, 0.005089380098815465, 0.005089380098815465, 0.005089380098815465], :CellDx =&gt; [0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005  …  0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005, 0.005]))</code></pre><h1 id="Setup-the-timestepping-and-boundary-conditions"><a class="docs-heading-anchor" href="#Setup-the-timestepping-and-boundary-conditions">Setup the timestepping and boundary conditions</a><a id="Setup-the-timestepping-and-boundary-conditions-1"></a><a class="docs-heading-anchor-permalink" href="#Setup-the-timestepping-and-boundary-conditions" title="Permalink"></a></h1><p>Set timesteps</p><pre><code class="language-julia hljs">t_press = 15
t_ads = 15
t_blow = 30
t_evac= 40

t_stage = [t_press, t_ads, t_blow, t_evac]

cycle_time = sum(t_stage)
step_end = cumsum(t_stage)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">4-element Vector{Int64}:
  15
  30
  60
 100</code></pre><p>cell<em>right = simulator.model.data</em>domain</p><p>d_press: Optimize PL [0.05 - 0.5] bar but maybe go even lower (0.01?)</p><pre><code class="language-julia hljs">d_press = Mocca.PressurisationBC(y_feed = constants.y_feed, PH = constants.p_high, PL = constants.p_low,
                                λ = constants.λ, T_feed = constants.T_feed, cell_left = 1, cell_right = ncells,
                                cycle_time = cycle_time, previous_step_end = 0)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Mocca.PressurisationBC{Float64, 2}
  y_feed: StaticArraysCore.SVector{2, Float64}
  PH: Float64 100000.0
  PL: Float64 10000.0
  λ: Float64 0.5
  T_feed: Float64 298.15
  cell_left: Int64 1
  cell_right: Int64 200
  cycle_time: Float64 100.0
  previous_step_end: Float64 0.0
</code></pre><p>d<em>ads: Optimize v</em>feed []</p><pre><code class="language-julia hljs">d_ads = Mocca.AdsorptionBC(y_feed = constants.y_feed, PH = constants.p_high, v_feed = constants.v_feed,
                                T_feed = constants.T_feed, cell_left = 1, cell_right = ncells) #TODO: Don&#39;t hardcode end cell!</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Mocca.AdsorptionBC{Float64, 2}
  y_feed: StaticArraysCore.SVector{2, Float64}
  PH: Float64 100000.0
  v_feed: Float64 0.37
  T_feed: Float64 298.15
  cell_left: Int64 1
  cell_right: Int64 200
</code></pre><p>d<em>blow: Optimize PI [0.05 - 0.5] bar (should be 0.01 bar diff between d</em>press and d_blow)</p><pre><code class="language-julia hljs">d_blow = Mocca.BlowdownBC(PH = constants.p_high, PI = constants.p_intermediate,
                            λ = constants.λ, cell_left = 1, cell_right = ncells,
                            cycle_time = cycle_time, previous_step_end = step_end[2])


                            #TODO: Don&#39;t hardcode end cell!</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Mocca.BlowdownBC{Float64}
  PH: Float64 100000.0
  PI: Float64 20000.0
  λ: Float64 0.5
  cell_left: Int64 1
  cell_right: Int64 200
  cycle_time: Float64 100.0
  previous_step_end: Float64 30.0
</code></pre><p>d<em>evac: Optimize PI [0.05 - 0.5] bar (should be 0.01 bar diff between d</em>press and d_blow)</p><pre><code class="language-julia hljs">d_evac = Mocca.EvacuationBC(PL = constants.p_low, PI = constants.p_intermediate,
                            λ = constants.λ, cell_left = 1, cell_right = ncells,
                            cycle_time = cycle_time, previous_step_end = step_end[3])
                            #TODO: Don&#39;t hardcode end cell!</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Mocca.EvacuationBC{Float64}
  PL: Float64 10000.0
  PI: Float64 20000.0
  λ: Float64 0.5
  cell_left: Int64 1
  cell_right: Int64 200
  cycle_time: Float64 100.0
  previous_step_end: Float64 60.0
</code></pre><p>numstages = 4</p><pre><code class="language-julia hljs">bcs = [d_press, d_ads, d_blow, d_evac]






numcycles = 3

timesteps = []
sim_forces = []
maxdt = 1



for j = 1:numcycles
    for i in eachindex(t_stage)
        numsteps = t_stage[i] / maxdt
        append!(timesteps,repeat([maxdt],Int(floor(numsteps))))
        append!(sim_forces,repeat([Jutul.setup_forces(model,bc=bcs[i])],Int(floor(numsteps))))
    end
end</code></pre><h1 id="Simulate"><a class="docs-heading-anchor" href="#Simulate">Simulate</a><a id="Simulate-1"></a><a class="docs-heading-anchor-permalink" href="#Simulate" title="Permalink"></a></h1><pre><code class="language-julia hljs">#WRITE
states, report = Jutul.simulate(
    state0,
    model,
    timesteps,
    forces=sim_forces,
    parameters = prm,
    info_level = 0
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">SimResult with 300 entries:

  states (model variables)
    :AdsorbedConcentration =&gt; Matrix{Float64} of size (2, 200)
    :y =&gt; Matrix{Float64} of size (2, 200)
    :Pressure =&gt; Vector{Float64} of size (200,)
    :Temperature =&gt; Vector{Float64} of size (200,)
    :TotalMasses =&gt; Matrix{Float64} of size (2, 200)
    :WallTemperature =&gt; Vector{Float64} of size (200,)

  reports (timing/debug information)
    :ministeps =&gt; Vector{Any} of size (1,)
    :total_time =&gt; Float64
    :output_time =&gt; Float64

  Completed at Nov. 28 2023 22:11 after 6 seconds, 138 milliseconds.</code></pre><h1 id="Plot"><a class="docs-heading-anchor" href="#Plot">Plot</a><a id="Plot-1"></a><a class="docs-heading-anchor-permalink" href="#Plot" title="Permalink"></a></h1><pre><code class="language-julia hljs">#WRITE :

outlet_cell = ncells
f_outlet = Mocca.plot_cell(states,model,timesteps,outlet_cell)
display(f_outlet)

f_column = Mocca.plot_state(states[end], model)
display(f_column)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">CairoMakie.Screen{IMAGE}
</code></pre><h2 id="Example-on-GitHub"><a class="docs-heading-anchor" href="#Example-on-GitHub">Example on GitHub</a><a id="Example-on-GitHub-1"></a><a class="docs-heading-anchor-permalink" href="#Example-on-GitHub" title="Permalink"></a></h2><p>If you would like to run this example yourself, it can be downloaded from <a href="https://github.com/sintefmath/Mocca.jl/blob/main/examples/simulate_cyclic.jl">the Mocca.jl GitHub repository</a>.</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../simulate_DCB/">« Simulate DCB</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.1.2 on <span class="colophon-date" title="Tuesday 28 November 2023 22:15">Tuesday 28 November 2023</span>. Using Julia version 1.9.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
